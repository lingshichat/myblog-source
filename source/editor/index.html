<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫ëÁ´ØÁÅµÊÑüÁ©∫Èó¥ | Editor</title>

    <!-- Libraries -->
    <link rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css">
    <script src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
    <script type="module" src="https://cdn.skypack.dev/@octokit/rest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Custom Style -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="app" v-cloak>
        <!-- üîê ÁôªÂΩïÁïåÈù¢ -->
        <div v-if="!isLoggedIn" class="login-container">
            <div class="glass-card login-card">
                <div class="login-header">
                    <i class="fa-solid fa-cloud"></i>
                    <h2>‰∫ëÁ´ØÈÄöË°åËØÅ</h2>
                </div>
                <div class="login-body">
                    <div class="input-group">
                        <i class="fa-solid fa-key"></i>
                        <input type="password" v-model="password" @keyup.enter="login" placeholder="ËØ∑ËæìÂÖ•ËÆøÈóÆÂØÜÁ†Å..."
                            autofocus>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="remember" v-model="rememberMe">
                        <label for="remember">ËÆ∞‰ΩèÊàë (Ëá™Âä®ÁôªÂΩï)</label>
                    </div>
                    <button @click="login" :disabled="loading" class="btn-glow">
                        <span v-if="loading"><i class="fa-solid fa-spinner fa-spin"></i> È™åËØÅ‰∏≠...</span>
                        <span v-else>Ëß£ÈîÅËøõÂÖ•</span>
                    </button>
                    <p v-if="errorMsg" class="error-msg">{{ errorMsg }}</p>
                </div>
            </div>
        </div>

        <!-- üìù ÁºñËæëÂô®ÁïåÈù¢ -->
        <div v-else class="editor-container">
            <!-- È°∂ÈÉ®ÂØºËà™ -->
            <nav class="glass-nav">
                <div class="nav-left">
                    <button class="nav-btn" @click="toggleSidebar">
                        <i class="fa-solid fa-bars"></i>
                    </button>
                    <span class="logo-text">ÁÅµÊÑüÁ©∫Èó¥</span>
                </div>
                <div class="nav-right">
                    <button class="nav-btn action-btn" @click="newPost">
                        <i class="fa-solid fa-plus"></i> <span class="desktop-only">Êñ∞Âª∫</span>
                    </button>
                    <button class="nav-btn action-btn primary" @click="savePost" :disabled="saving">
                        <i class="fa-solid" :class="saving ? 'fa-spinner fa-spin' : 'fa-paper-plane'"></i>
                        <span class="desktop-only">{{ saving ? 'ÂèëÂ∏É‰∏≠...' : 'ÂèëÂ∏É' }}</span>
                    </button>
                    <button class="nav-btn logout-btn" @click="logout" title="ÈÄÄÂá∫">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </button>
                </div>
            </nav>

            <div class="main-content">
                <!-- Â∑¶‰æßÊñáÁ´†ÂàóË°® -->
                <aside class="sidebar glass-panel" :class="{ 'open': sidebarOpen }">
                    <div class="sidebar-header">
                        <h3>ÊñáÁ´†ÂàóË°®</h3>
                        <button @click="fetchPosts" title="Âà∑Êñ∞"><i class="fa-solid fa-rotate-right"></i></button>
                    </div>
                    <ul class="post-list">
                        <li v-for="post in posts" :key="post.sha" @click="loadPost(post)"
                            :class="{ active: currentPost && currentPost.sha === post.sha }">
                            <span class="post-title">{{ post.name.replace('.md', '') }}</span>
                            <span class="post-date text-xs">{{ formatDate(post.date) }}</span> <!-- ÈúÄË¶ÅÂêéÁª≠ÂÆûÁé∞Ëé∑ÂèñÊó•Êúü -->
                        </li>
                        <li v-if="posts.length === 0" class="empty-state">ÊöÇÊó†ÊñáÁ´†ÊàñÂä†ËΩΩ‰∏≠...</li>
                    </ul>
                </aside>

                <!-- Ê†∏ÂøÉÁºñËæëÂå∫ -->
                <main class="editor-area glass-panel">
                    <div class="metadata-form">
                        <input type="text" v-model="postTitle" placeholder="Âú®Ê≠§ËæìÂÖ•ÊñáÁ´†Ê†áÈ¢ò..." class="title-input">
                        <div class="meta-tags">
                            <input type="text" v-model="postDate" placeholder="YYYY-MM-DD HH:mm:ss" class="meta-input">
                            <input type="text" v-model="postTags" placeholder="Ê†áÁ≠æ (ÈÄóÂè∑ÂàÜÈöî)" class="meta-input">
                            <input type="text" v-model="postCategories" placeholder="ÂàÜÁ±ª" class="meta-input">
                            <!-- ÁßªÂä®Á´ØËßÜÂõæÂàáÊç¢ -->
                            <div class="view-toggle mobile-only">
                                <button :class="{active: !previewMode}" @click="previewMode = false">ÁºñËæë</button>
                                <button :class="{active: previewMode}" @click="previewMode = true">È¢ÑËßà</button>
                            </div>
                        </div>
                    </div>

                    <div class="editor-wrapper" :class="{ 'preview-active': previewMode }">
                        <textarea id="markdown-editor"></textarea>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="auth.js"></script>
    <script type="module" src="app.js"></script>
</body>

</html>